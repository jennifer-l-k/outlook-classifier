!function(){var t,e,n={};function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){u=!0,i=t},f:function(){try{r||null==n.return||n.return()}finally{if(u)throw i}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var a="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:void 0;Office.onReady((function(n){for(var o in t=Office.context.mailbox.item,e=Office.context.mailbox,i){var s=i[o];a[s.globalFunction]=m(s)}console.log("Office.js is now ready in ".concat(n.host," on ").concat(n.platform))})),a.validateBody=function(e){!function(e){t.subject.getAsync({asyncContext:e},(function(e){var n,s=e.value,a=f(s);if(!a)return t.notificationMessages.addAsync("NoSend",{type:"errorMessage",message:"Please choose a classification for this email."}),void e.asyncContext.completed({allowEvent:!1});n=function(n){if(null!=n.classification&&n.classification!=a.name)return t.notificationMessages.addAsync("NoSend",{type:"errorMessage",message:"Message classified "+a.name+" with "+n.classification+" attachment"}),void e.asyncContext.completed({allowEvent:!1});Office.context.mailbox.item.saveAsync((function(n){!function(t,e,n,o){if(!t)return console.log("Ignoring invalid itemId in setCategory: "+t),void o(n);F(y('<UpdateItem MessageDisposition="SaveOnly" ConflictResolution="AlwaysOverwrite" xmlns="http://schemas.microsoft.com/exchange/services/2006/messages">\n\t\t\t<ItemChanges>\n\t\t\t\t<t:ItemChange>\n\t\t\t\t\t<t:ItemId Id="'+t+'"/>\n\t\t\t\t\t<t:Updates>\n\t\t\t\t\t\t<t:SetItemField>\n\t\t\t\t\t\t\t<t:ExtendedFieldURI PropertySetId="00020329-0000-0000-C000-000000000046" PropertyName="Keywords" PropertyType="StringArray" />\n\t\t\t\t\t\t\t<t:Message>\n\t\t\t\t\t\t\t\t<t:ExtendedProperty>\n\t\t\t\t\t\t\t\t\t<t:ExtendedFieldURI PropertySetId="00020329-0000-0000-C000-000000000046" PropertyName="Keywords" PropertyType="StringArray" />\n\t\t\t\t\t\t\t\t\t<t:Values>\n\t\t\t\t\t\t\t\t\t\t<t:Value>'+e+"</t:Value>\n\t\t\t\t\t\t\t\t\t</t:Values>\n\t\t\t\t\t\t\t\t</t:ExtendedProperty>\n\t\t\t\t\t\t\t</t:Message>\n\t\t\t\t\t\t</t:SetItemField>\n\t\t\t\t\t</t:Updates>\n\t\t\t\t</t:ItemChange>\n\t\t\t</ItemChanges>\n\t\t</UpdateItem>"),(function(t){console.log("Successfully set category: "+t),o(n)}),(function(t){console.log("Error setting category: "+t),o(n)}))}(n.value,a.name,e.asyncContext,(function(e){!function(e,n){t.subject.setAsync(e,{asyncContext:n},(function(e){e.status==Office.AsyncResultStatus.Failed?(t.notificationMessages.addAsync("NoSend",{type:"errorMessage",message:"Unable to set the subject."}),e.asyncContext.completed({allowEvent:!1})):e.asyncContext.completed({allowEvent:!0})}))}(s=d(s),e)}))}))},Office.context.mailbox.item.saveAsync((function(t){var e,s,a=t.value;e=function(t){0!=t.length?Office.context.mailbox.getCallbackTokenAsync((function(e){if(e.status==Office.AsyncResultStatus.Succeeded){var o={token:e.value,ews_url:Office.context.mailbox.ewsUrl,attachment_ids:t},s=JSON.stringify(o),a=new XMLHttpRequest;a.open("POST","https://localhost:4430/api/attachment"),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.onreadystatechange=function(){4===a.readyState&&n(JSON.parse(a.response))},a.send(s)}})):n("")},s=function(t){console.log(t)},F(y('<m:GetItem>\n    <m:ItemShape>\n      <t:BaseShape>IdOnly</t:BaseShape>\n      <t:AdditionalProperties>\n        <t:FieldURI FieldURI="item:Attachments" />\n      </t:AdditionalProperties>\n    </m:ItemShape>\n    <m:ItemIds>\n      <t:ItemId Id="'+a+'" />\n    </m:ItemIds>\n  </m:GetItem>'),(function(t){var n,s=[],a=o(g(t,"t:AttachmentId"));try{for(a.s();!(n=a.n()).done;){var i=n.value;console.log(i.attributes),s.push(i.attributes.Id.value)}}catch(t){a.e(t)}finally{a.f()}e(s)}),(function(t){null!=s&&s(t)}))}))}))}(e)};var i={white:{name:"TLP:WHITE",globalFunction:"actionMarkWhite",subject:"[Classified White âšª]",icon80:"Icon.80x80"},green:{name:"TLP:GREEN",globalFunction:"actionMarkGreen",subject:"[Classified Green ðŸŸ¢]",icon80:"IconGreen.80x80"},amber:{name:"TLP:AMBER",globalFunction:"actionMarkAmber",subject:"[Classified Amber ðŸŸ ]",icon80:"IconOrange.80x80"},red:{name:"TLP:RED",globalFunction:"actionMarkRed",subject:"[Classified Red ðŸ”´]",icon80:"IconRed.80x80"}},r=/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\[cla[s\u017F][s\u017F]ified (white|green|amber|red) (?:[\0-\/:-@\[-\^`\{-\u017E\u0180-\u2129\u212B-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*/gi,u=/^(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?re:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?aw:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]?)*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\[cla[s\u017F][s\u017F]ified (white|green|amber|red) (?:[\0-\/:-@\[-\^`\{-\u017E\u0180-\u2129\u212B-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\](?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*/i;function c(t){return t.replace(r," ").trim()}function l(t,e){return t?t.subject+" "+e:e}function f(t){if(t=t.toLowerCase(),u.test(t)){var e=t.match(u);return i[e[1]]}return null}function d(t){var e=f(t);return e?t=l(e,t=c(t)):t}function m(e){return function(n){var s,a,i={type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,message:"Marked message "+e.name,icon:e.icon80,persistent:!1},r={type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:"Failed to mark message (requested "+e.name+")"};s=e,a=function(t){t?Office.context.mailbox.item.notificationMessages.replaceAsync("action",i):Office.context.mailbox.item.notificationMessages.replaceAsync("action",r),n.completed()},function(t,e,n){t||e([]);var s='       <m:GetConversationItems>           <m:ItemShape>               <t:BaseShape>IdOnly</t:BaseShape>               <t:AdditionalProperties>                   <t:FieldURI FieldURI="item:Subject" />                   <t:FieldURI FieldURI="item:DateTimeReceived" />               </t:AdditionalProperties>           </m:ItemShape>           <m:FoldersToIgnore>               <t:DistinguishedFolderId Id="deleteditems" />               <t:DistinguishedFolderId Id="drafts" />           </m:FoldersToIgnore>           <m:SortOrder>TreeOrderDescending</m:SortOrder>           <m:Conversations>               <t:Conversation>                   <t:ConversationId Id="'+t+'" />               </t:Conversation>           </m:Conversations>       </m:GetConversationItems>';F(s=y(s),(function(t){var n,s=[],a=o(g(t,"t:Subject"));try{for(a.s();!(n=a.n()).done;){var i=n.value;s.push(i.textContent)}}catch(t){a.e(t)}finally{a.f()}e(s)}),(function(t){null!=n&&n()}))}(t.conversationId,(function(e){var n,i=!1,r="",u=o(e);try{for(u.s();!(n=u.n()).done;){value=n.value;var m=f(value);if(m){i=!0,r=m;break}}}catch(t){u.e(t)}finally{u.f()}t.subject.getAsync((function(e){if(e.status==Office.AsyncResultStatus.Failed)console.log(e.error.message),a(!1);else{var n=e.value,o=f(n);if(o)if(i){if(o.subject!==r.subject||r.subject!==s.subject)return void a(!1);n=d(n)}else n=c(n),n=l(s,n);else n=l(i?r:s,n);t.subject.setAsync(n,null,(function(t){t.status==Office.AsyncResultStatus.Failed?(console.log(t.error.message),a(!1)):a(!0)}))}}))}),(function(t){a(!1)}))}}function F(t,n,o){e.makeEwsRequestAsync(t,(function(t){if(t.status===Office.AsyncResultStatus.Succeeded){console.log("makeEwsRequestAsync success. "+t.status);var e=(new DOMParser).parseFromString(t.value,"text/xml");n(e)}else console.log("makeEwsRequestAsync failed. "+t.error),o(t.error)}))}function g(t,e){var n=e.substring(e.indexOf(":")+1),o=t.getElementsByTagName(e);return null!=o&&0!=o.length||(o=t.getElementsByTagName(n)),o}function y(t){return'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"               xmlns:xsd="http://www.w3.org/2001/XMLSchema"               xmlns:m="http://schemas.microsoft.com/exchange/services/2006/messages"               xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"               xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types">   <soap:Header>       <RequestServerVersion Version="Exchange2013" xmlns="http://schemas.microsoft.com/exchange/services/2006/types" soap:mustUnderstand="0" />   </soap:Header>   <soap:Body>'+t+"</soap:Body></soap:Envelope>"}}();
//# sourceMappingURL=commands.js.map